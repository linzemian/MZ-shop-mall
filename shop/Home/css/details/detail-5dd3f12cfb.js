!function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var i={};return t.m=e,t.c=i,t.p="/detail/",t(0)}(function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))switch(typeof e[t]){case"function":break;case"object":e[t]=function(t){var i=t.slice(1),n=e[t[0]];return function(e,t,a){n.apply(this,[e,t,a].concat(i))}}(e[t]);break;default:e[t]=e[e[t]]}return e}([function(e,t,i){i(1),i(5);var n=i(7);i(8),i(31),i(32),i(33);var a=i(34);n(function(){var e={imgBooth:n("#J_imgBooth"),detailFastTab:n("#detailFast li")};n("#detail").vtab({navSelector:".detail-tab ul",contSelector:".detail-content",afterActive:function(t,i,a){var s=t.parents(".detail-tab");(s.hasClass("fixed")||"gotop"===a)&&n("html,body").animate({scrollTop:n("#detail").offset().top-80},150),e.detailFastTab.eq(i).addClass("current").siblings().removeClass("current")}}),e.detailFastTab.on("click",function(e){var t=n(this),i=t.index();n("#detail .detail-tab li").eq(i).trigger("click",["gotop"]),t.addClass("current").siblings().removeClass("current"),e.preventDefault()}),n("#J_btnBuyShortcut").on("click",function(){n("#J_btnBuy").trigger("click")}),n("#J_previewThumb").on("click","li",function(t){t.preventDefault();var i=n(this),a=i.find("img").attr("src"),s="680x680",o=a.replace(/([\@]?)120x120(\.[\w]+)$/,"$1"+s+"$2");i.hasClass("current")||(i.addClass("current").siblings().removeClass("current"),e.imgBooth.find("img").attr("src",o).hide().fadeIn())}),n("#introduce .lazy").lazyload({threshold:300}),n("#detailFast").scrollfix({min:".property-sell",max:".site-footer"}),n("#detailFast").scrollfix({min:".property-buy-quantity",fixClass:"float-button"}),n("#detailFast").scrollfix({min:"#detail",max:".site-footer",fixClass:"float-nav",onEnter:function(){n("#detailTabFixed").find("ul").hide()},onLeave:function(){n("#detailTabFixed").find("ul").show()}}),n("#J_btnBuyShortcut").on("click",function(){n("html,body").animate({scrollTop:n("#property").offset().top},200)}),new a({speed:600,smartHeight:500})})},function(e,t){},,,,1,,function(e,t){e.exports=meizuStoreGlobal.jquery},function(e,t,i){i(9);var n=i(7),a=i(18),s=i(19).login,o=i(20),r=i(21),c=i(22),d=i(23),l=i(25),u=i(27),h=i(28),m=i(29),p=i(30),f=window.MZ,g=f.modelData;n.fn.extend({lockButton:function(e){var t=n(this);e=e||3e3,t.addClass("locked").prop("disabled",!0),window.setTimeout(function(){t.removeClass("locked").prop("disabled",!1)},e)}});var v,y,b,k,_,w;w={price:n("#J_price"),totalPriceShortcut:n("#J_totalPriceShortcut"),btnBuy:n("#J_btnBuy"),packageTab:n("#J_packageTab"),packageContent:n("#J_packageContent"),packageBody:n("#J_packageBody"),summaryMain:n("#J_summaryMain"),imgBooth:n("#J_imgBooth"),previewThumb:n("#J_previewThumb"),propertyPackage:n("#propertyPackage"),quantity:n("#J_quantity"),sumaryPackageItemNames:n("#J_sumaryPackageItemNames"),message:n("#J_message"),serverTime:n("#servertime"),panicBuyingWrap:n("#J_panicBuyingWrap"),summaryName:n("#J_summaryName"),activity:n("#J_activity"),discountTag:n("#J_discountTag"),originalPrice:n("#J_originalPrice"),discountCountDown:n("#J_discountCountDown")},b=o.Model.extend({defaults:{buyButton:"",images:null,names:"",packageIds:null,price:"",priceCent:0,pvs:"",skuId:0,stock:0}}),k=o.Collection.extend({model:b}),v=o.Model.extend({defaults:{buyButton:"",images:null,names:"",packageIds:null,price:"",priceCent:0,pvs:"",skuId:"",stock:"",attributes:"",propItem:null,propSet:null,total:0,quantity:1,activePackage:"",packageSet:null,packageSkuIds:null,packageTotalPriceCent:0,packageTotalProfitsCent:0,packageMap:null,packageStock:null,packageItems:null,initSelectedPackage:!1,skuIdChangeTarget:"",costPriceCent:0,isPanicBuying:!1,panicToken:""}}),y=o.View.extend({events:{"click .property-set-sale a":"setProp","click #J_packageTab a":"setPackage","click .vm-minus":"quantityMinus","click .vm-plus":"quantityPlus","keyup #J_quantity":"enterQuantity","click .vm-prop a":"activePackageItem","click #J_btnBuy":"distributeSubmit","click #J_panicBuyingLogin":"triggerLogin"},packageTabCompiled:a.template(h),packageItemCompiled:a.template(m),imgLoaded:[],initialize:function(){var e=this,t=e.model;e.listenTo(e.model,"change:pvs",e.updatePvs),e.listenTo(e.model,"change:propSet",e.mergeSkuModel),e.listenTo(e.model,"change:activePackage",e.activePackage),e.listenTo(e.model,"change:packageIds",e.handlerPackage),e.listenTo(e.model,"change:names",e.updateNames),e.listenTo(e.model,"change:images",e.updateImages),e.listenTo(e.model,"change:stock",e.updateStock),e.listenTo(e.model,"change:buyButton",e.updateButton),e.listenTo(e.model,"change:packageName",e.updateSummaryInfo),e.listenTo(e.model,"change:attributes",e.updateSummaryInfo),e.listenTo(e.model,"change:mainPriceCent",e.updatePrice),e.listenTo(e.model,"change:packageTotalPriceCent",e.setTotalPrice),e.listenTo(e.model,"change:total",e.updateTotal),e.listenTo(e.model,"change:quantity",e.updateQuantity),e.listenTo(e.model,"change:skuId",e.handlerPriceOrDiscount),e.listenTo(e.model,"change:costPriceCent",e.updateCostPrice),t.get("isPanicBuying")&&(e.listenTo(e.model,"change:skuId",e.panicBuyingStockStatus.bind(e,"skuId")),e.listenTo(e.model,"change:packageSkuIds",e.panicBuyingStockStatus.bind(e,"packageSkuIds"))),e.initSku()},initSku:function(){var e=this,t=e.model,i=t.get("pvs"),a=i.split("+")[0],s=i.split("+")[1],o=a.split(";"),r=[],c=[],d={};n.each(o,function(t,i){c=i.split(":"),d[c[0]]=i,r.push(c[0]),e.$el.find('[data-value="'+i+'"]').addClass("selected")}),t.set({propItem:r,propSet:d}),void 0!==s&&(t.set("pvs",a,{silent:!0}),e.initPackage(s)),e.analysis(),e.syncSoonSale(),e.initPageContent()},initPageContent:function(){var e=this,t=Number(w.serverTime.val()),i=f.modelData.discount&&f.modelData.discount.endTime;f.modelData.discount&&t<i&&e.countDown(w.serverTime.val(),f.modelData.discount.endTime,_.getDiscountTime,e.closeDiscountCountDown),w.quantity.val(1),e.syncQuantityStatus(1)},initPackage:function(e){var t=this;t.model.set({initSelectedPackage:!0}),w.packageTab.find('[data-value="'+e+'"]').trigger("click",[!0])},closeDiscountCountDown:function(){location.reload()},triggerLogin:function(){var e=n(".site-login").attr("href");location.href=e},quantityMinus:function(e){e.preventDefault();var t=n(e.currentTarget),i=t.siblings("input"),a=i.val();a=n.isNumeric(a)?parseInt(a,10)-1:1,a<=0&&(a=1),this.model.set("quantity",a)},quantityPlus:function(e){e.preventDefault();var t=n(e.currentTarget),i=t.siblings("input"),a=i.data("max"),s=i.val();s=n.isNumeric(s)?parseInt(s,10)+1:1,a&&s>=a?s=a:s>500&&(s=500),this.model.set("quantity",s)},enterQuantity:function(e){e.preventDefault();var t=n(e.currentTarget),i=t.data("max"),a=t.val();a=n.isNumeric(a)?parseInt(a,10):1,a<=0&&(a=1),i&&a>=i?a=i:a>500&&(a=500),t.val(a),this.model.set("quantity",a)},getSkuModel:function(e){var t,i=this,a=i.collection,s=n.extend({},a.get(e).toJSON()),o=s.id.split(";");return n.each(o,function(e,i){t=i.split(":"),delete s[t[0]]}),delete s.id,s},handlerPriceOrDiscount:function(){var e,t,i,a=this,s=a.model,o=s.get("discountKeys"),r=s.get("priceCent"),c=s.get("pvs");e=s.get("isPackage")&&s.get("activePackage")?c+"+"+s.get("activePackage"):o&&n.inArray(c+"+0",o)!==-1?c+"+0":c,o&&n.inArray(e,o)!==-1?(t=f.modelData.discount.cspuMap[e].priceCent,i=r):(t=r,i=0),s.set({mainPriceCent:t,costPriceCent:i})},updateSummaryInfo:function(){var e=this.model,t=e.get("attributes"),i=e.get("packageName"),n=t;i&&(n+=" "+i),w.summaryName.text(n)},updatePrice:function(e,t){w.price.text((t/100).toFixed(2)),this.setTotalPrice()},setTotalPrice:function(){var e=this,t=e.model,i=t.get("packageTotalPriceCent"),n=t.get("mainPriceCent");t.set("total",i+n)},updateCostPrice:function(){var e=this,t=e.model.get("costPriceCent"),i=e.model.get("mainPriceCent"),n=e.model.get("packageTotalPriceCent"),a=e.model.get("packageTotalProfitsCent");t>0&&i<t?(n&&(t=t+n+a),w.originalPrice.text("¥ "+(t/100).toFixed(2)).show(),w.activity.show(),w.discountTag.text("限时折扣："),w.discountCountDown.show()):(w.originalPrice.empty().hide(),w.activity.hide(),w.discountTag.html('价<span class="s-space"></span><span class="s-space"></span>格：'),w.discountCountDown.hide())},updateTotal:function(e,t){var i,n=e.get("quantity");t=t||e.get("total"),i=t/100*n,w.price.text((t/100).toFixed(2)),w.totalPriceShortcut.text("￥"+i.toFixed(2))},updateNames:function(e,t){w.summaryMain.html(t+"&nbsp;&nbsp;￥"+e.get("price"))},updateStock:function(e,t){var i=e.get("buyButton");e.get("isPanicBuying")||(_.isComingSale()?w.btnBuy.text("即将发售").addClass("disabled"):t<=0?w.btnBuy.text(i).addClass("disabled"):w.btnBuy.text("立即购买").removeClass("disabled"))},updateButton:function(e,t){var i=e.get("stock"),n=_.isComingSale();e.get("isPanicBuying")||!n&&i<=0&&w.btnBuy.text(t)},preloadImages:function(e){var t,i=this;e&&e.length&&(t=n.map(e,function(e){return i.imageUrlProcess(e,680)}),n.each(t,function(e,t){if(n.inArray(t,i.imgLoaded)===-1){var a=new Image;a.src=t,a.complete?i.imgLoaded.push(t):a.onload=a.onerror=function(){i.imgLoaded.push(a),a.onload=a.onerror=null}}}))},imageUrlProcess:function(e,t,i){var n;return i=i||".jpg",n=/^\/\/openfile/.test(e)?e+t+"x"+t+i:e+"@"+t+"x"+t+i},updateImages:function(e,t){var i=this,a=i.imageUrlProcess(t[0],680),s="";w.imgBooth.find("img").attr("src",a),n.each(t,function(e){var n=i.imageUrlProcess(t[e],120);s+='<li><a data-mtype="store_de_tp_'+(e+1)+'" href="#"><img src="'+n+'" width="75" height="75"></a></li>'}),w.previewThumb.html(s),w.previewThumb.find("li:first").addClass("current"),i.preloadImages(t)},updatePvs:function(e,t){var i=e.get("packageStock"),n=e.get("activePackage"),a=t+"+"+n;i[a]&&e.set({buyButton:i[a].buyButton,skuId:i[a].skuId,stock:i[a].stock})},syncSoonSale:function(){var e,t=this,i=this.model,n=i.get("isPanicBuying"),o=f.modelData.activeStatus,r=f.modelData.shelveTime,c=s.isLogin,d=_.getWaitingTime(),l=w.serverTime.val(),u=Math.ceil((r-l)/1e3),h=[];2===o&&(u>7200?h.push('&nbsp;<em id="J_panicBuyingCountDown">'+d+"</em> "):u>0&&(h.push('距开售还剩 <em id="J_panicBuyingCountDown">'+d+"</em> "),n&&!c&&h.push("请预先登录账号")),w.panicBuyingWrap.html(h.join("，")),e=1===f.modelData.type?t.countDownDoBuying:t.countDownDoPanicBuying,u<7200&&t.countDown(l,f.modelData.shelveTime,t.syncShelveTime,a.bind(e,t)),1===f.modelData.type&&w.btnBuy.text("即将发售").addClass("disabled")),n&&(3===o||c||w.btnBuy.text("请先登录").removeClass("disabled").addClass("notlogin"),1===o&&t.panicBuyingStockStatus())},panicBuyingStockStatus:function(e){var t=this,i=t.model,n=f.modelData.activeStatus;if(!("skuId"===e&&"package"===i.get("skuIdChangeTarget")||"packageSkuIds"===e&&!i.get("packageSkuIds"))&&1===n)return s.isLogin?void t.getPanicBuyingStatus().done(function(i){if(3===i.activeStatus)return w.btnBuy.text("活动已结束").addClass("disabled"),w.panicBuyingWrap.empty(),_.closeOrderModal(),void(f.modelData.activeStatus=3);switch(i.stockStatus){case 1:w.panicBuyingWrap.empty(),1===i.activeStatus&&w.btnBuy.hasClass("disabled")&&w.btnBuy.text("立即抢购").removeClass("disabled"),"buying"===e&&t.orderToken&&t.buyNow(t.orderToken);break;case 2:w.btnBuy.text("还有机会").addClass("disabled"),w.panicBuyingWrap.html("该商品有用户下单后未付款，还有机会抢到"),_.closeOrderModal();break;case 3:w.btnBuy.text("已售罄").addClass("disabled"),w.panicBuyingWrap.empty(),_.closeOrderModal()}}):void w.btnBuy.text("请先登录").addClass("notlogin")},getPanicBuyingStatus:function(){var e=this,t=e.model,i=t.get("skuId"),a=t.get("activePackage"),s=t.get("packageSkuIds"),o=n.Deferred();return i?n.ajax({url:_.remoteURL.getPanicBuyingStatus,type:"get",data:{skuId:i,packageId:a||"",packageSkuIdList:s?s.join(","):""},dataType:"json"}).done(function(e){e.success?o.resolve(e.data):o.reject(e.error)}).fail(function(){o.reject()}):o.reject(),o.promise()},countDownDoBuying:function(){var e=f.modelData.shelveTime;f.modelData.activeStatus=1,w.btnBuy.text("立即购买").removeClass("disabled"),w.panicBuyingWrap.empty(),w.serverTime.val(e+1)},countDownDoPanicBuying:function(){function e(){n.ajax({url:_.remoteURL.getSaleStatus,type:"get",data:{id:f.modelData.itemId},dataType:"json"}).done(function(e){1===e.data.activeStatus&&(w.btnBuy.hasClass("disabled")&&w.btnBuy.text("立即抢购").removeClass("disabled"),f.modelData.activeStatus=1,i.panicBuyingStockStatus(),clearInterval(t))})}var t,i=this;e(),w.panicBuyingWrap.empty(),t=setInterval(function(){e()},2e3)},countDown:function(e,t,i,n){var a=Math.ceil((t-e)/1e3),s=setInterval(function(){a<=0?(n&&n(),clearInterval(s)):i&&i(a,s),a--},1e3)},syncQuantityStatus:function(e){var t=w.quantity.data("max");t&&e>=t?w.quantity.next().addClass("disabled"):w.quantity.next().removeClass("disabled"),1===e?w.quantity.prev().addClass("disabled"):w.quantity.prev().removeClass("disabled")},updateQuantity:function(e,t){var i=this;i.syncQuantityStatus(t),w.quantity.val(t),i.updateTotal(e)},setProp:function(e){e.preventDefault();var t=this,i=t.model,a=n(e.currentTarget),s=a.data("value"),o=s.split(":"),r=n.extend({},i.get("propSet"));void 0!==r[o[0]]&&(a.hasClass("disabled")||(a.hasClass("selected")?(r[o[0]]="",i.set({propSet:r,skuIdChangeTarget:"prop"}),a.removeClass("selected")):(r[o[0]]=s,i.set({propSet:r,skuIdChangeTarget:"prop"}),a.addClass("selected").siblings().removeClass("selected")),t.analysis(),t.clearMessage()))},setPackage:function(e,t){e.preventDefault();var i=this,a=i.model,s=a.get("packageMap"),o=n(e.currentTarget),r=o.data("value"),c=o.attr("title");t=a.get("initSelectedPackage"),o.hasClass("disabled")||(o.hasClass("selected")?(a.set({activePackage:"",skuIdChangeTarget:"package",packageName:""}),o.removeClass("selected"),o.find(".vm-text-price").text(s[r].price+"元"),o.find(".vm-text-profits").html("省<em>"+s[r].profits+"</em>元")):(o.addClass("selected").siblings().removeClass("selected"),a.set({activePackage:r,skuIdChangeTarget:"package",packageName:c})),t&&a.set({initSelectedPackage:!1}),n("#J_triangle").hide().css("left",o.position().left+o.width()/2).show(),i.clearMessage())},handlerPackage:function(e,t){var i,a=this,s=e.get("packageMap"),o=[];t&&t.length?(n.each(t,function(e,t){i=s[t],i.id=t,o.push(i)}),w.packageTab.html(a.packageTabCompiled({packages:o})),w.packageContent.hide(),w.packageBody.empty(),w.propertyPackage.is(":hidden")&&w.propertyPackage.slideDown()):(w.propertyPackage.hide(),w.packageTab.empty(),w.packageBody.empty()),e.set("activePackage","",{silent:!0}),e.set({packageSkuIds:null,packageTotalPriceCent:0})},activePackageItem:function(e){var t=this,i=n(e.currentTarget);i.addClass("selected").siblings().removeClass("selected"),t.switchPackageItem(e.currentTarget),t.packageCalculate(),t.updatePackagePrice(),t.updateCostPrice()},switchPackageItem:function(e){var t,i,a=this,s=a.model,o=s.get("packageItems"),r=n(e),c=r.data("sid"),d=r.data("key");c&&d&&(t=o[c].cells[d],i=a.imageUrlProcess(t.images,80),r.parents("li").find(".vm-pic img").attr({src:i,alt:t.names}))},packageCalculate:function(){var e,t=this,i=t.model,a=i.get("packageItems"),s=[],o=[],r={},c=0,d=0;w.packageBody.find(".selected").each(function(){var t=n(this),i=t.data("sku"),r=t.data("sid"),c=t.data("key");s.push(i),r&&c&&(e=a[r].cells[c],e.fullName=a[r].name+"&nbsp;"+e.names,o.push(e))}),n.each(o,function(e,t){r[t.skuId]=t.fullName,c+=t.priceCent,d+=t.originPriceCent-t.priceCent}),t.model.set({packageSkuIds:s,packageSet:r,packageTotalPriceCent:c,packageTotalProfitsCent:d})},updatePackagePrice:function(){var e=this,t=e.model.get("packageTotalPriceCent")/100,i=e.model.get("packageTotalProfitsCent")/100,n=w.packageTab.find(".selected").find(".vm-text-profits");w.packageTab.find(".selected").find(".vm-text-price").text(t+"元"),i>0?n.html("省<em>"+i+"</em>元").show():n.hide()},renderPackageContent:function(e){var t,i=this,a=i.model.get("packageItems"),s=i.model.get("initSelectedPackage"),o=[];e&&n.isArray(e)?(n.each(e,function(e,i){t=n.extend({},a[i]),t.id=i,o.push(t)}),w.packageBody.html(i.packageItemCompiled({items:o})),s?w.packageContent.show():w.packageContent.slideDown()):(w.packageContent.hide(),w.packageBody.empty(),w.packageTab.find(".selected").addClass("single"))},activePackage:function(e,t){var i=this,n=e.get("packageMap"),a=e.get("packageStock"),s=e.get("pvs")+"+"+t;(t||0===t)&&n[t]?(i.model.set({buyButton:a[s].buyButton,skuId:a[s].skuId,stock:a[s].stock}),i.renderPackageContent(n[t].items),i.packageCalculate()):(w.packageContent.hide(),w.packageBody.empty(),i.model.set({packageSkuIds:null,packageTotalPriceCent:0,packageTotalProfitsCent:0})),i.updateCostPrice()},mergeSkuModel:function(e,t){var i,s,o,r=this,c=r.model.get("propItem"),d=r.model.get("packageMap"),l=[];n.each(c,function(e,i){l.push(t[i])}),i=l.join(";"),r.collection.get(i)&&(s=r.getSkuModel(i),o=n.extend(!0,{},s),delete s.stock,delete s.skuId,delete s.buyButton,delete s.pvs,r.model.set(s),a.isEmpty(d)?(r.model.set("pvs",o.pvs,{silent:!0}),r.model.set({buyButton:o.buyButton,stock:o.stock,skuId:o.skuId})):""!==r.model.get("activePackage")?r.model.set("pvs",o.pvs):(r.model.set("skuId",""),r.handlerPriceOrDiscount(),r.model.set("pvs",o.pvs,{silent:!0})))},analysis:function(){var e,t,i=this,a=i.model.get("propItem"),s=n.extend({},i.model.get("propSet")),o=i.collection,r={};n.each(s,function(t,i){i&&(e=i.split(":"),r[e[0]]=e[1])}),n.each(a,function(e,a){var s=a,c=n.extend({},r),d=i.$el.find('.property-set-sale a[data-value^="'+s+'"]'),l=[];delete c[a],t=o.where(c),n.each(t,function(e,t){var i=t.get(s);n.inArray(i,l)===-1&&l.push(i)}),d.removeClass("disabled").filter(function(){var e=n(this).data("value"),t=e.split(":")[1];return n.inArray(t,l)===-1}).addClass("disabled")})},syncShelveTime:function(e){var t=!1,i=Math.floor(e%86400/3600),a=Math.floor(e%3600/60)<10?"0"+Math.floor(e%3600/60):Math.floor(e%3600/60),s=Math.floor(e%60)<10?"0"+Math.floor(e%60):Math.floor(e%60);e<=7200&&(t=i+"时"+a+"分"+s+"秒"),t&&n("#J_panicBuyingCountDown").text(t)},validate:function(){var e=this,t=e.model,i=e.$el.find(".property-set-sale"),s=t.get("propSet"),o=t.get("propItem"),r=t.get("quantity"),c=t.get("packageMap"),d=t.get("activePackage"),l=[],u=!0,h="";return s&&o.every(function(e){return""!==s[e]}),n.each(o,function(e,t){var n;s[t]||(n=i.eq(e).data("property"),l.push(n))}),a.isEmpty(c)||""!==d||l.push("套餐"),l.length&&(h="请选择："+l.join("、"),u=!1),n.isNumeric(r)||(h="请确认输入了正确的商品数量",u=!1),{isValid:u,message:h}},validateRemote:function(){function e(e){var t,i=[],o=!0;n.each(e,function(e,t){t||(i.push(e),o=!1)}),o?u.resolve():(t=i[0]==a?"商品"+s+" 已售罄":"套餐中的 "+d[i[0]]+" 已售罄",u.reject(t))}var t=this,i=t.model,a=i.get("skuId"),s=i.get("names"),o=i.get("packageMap"),r=i.get("activePackage"),c=i.get("packageSkuIds"),d=i.get("packageSet"),l=[],u=n.Deferred();return l.push(a),r&&c&&c.length&&(l=l.concat(c)),""!==r&&o[r]&&(s=s+" "+o[r].name),n.ajax({url:_.remoteURL.getStock,type:"get",data:{skuId:l.join(",")},dataType:"json"}).done(function(t){t.success?e(t.data):u.reject(t.error)}).fail(function(){}),u.promise()},clearMessage:function(){_.isComingSale()||w.message.text("").removeClass("error")},buyNow:function(e){var t=this,i=t.model.toJSON(),a=i.packageSkuIds?i.packageSkuIds.join(","):"",s=n("<form>"),o=['<input type="hidden" name="sku_id" value="'+i.skuId+'" />','<input type="hidden" name="numbers" value="'+i.quantity+'"/>','<input type="hidden" name="package_id" value="'+i.activePackage+'" />','<input type="hidden" name="package_list" value="'+a+'"/>'];e&&o.push('<input type="hidden" name="token" value="'+e+'"/>'),s.attr({action:_.remoteURL.orderAdd,method:"POST"}).html(o.join("")).appendTo("body").submit()},distributeSubmit:function(e){var t,i=this,a=i.model.get("isPanicBuying"),o=n(e.currentTarget);if(!o.hasClass("disabled")&&!o.hasClass("locked")){if(t=i.validate(),!t.isValid)return void w.message.html(t.message).addClass("error");if(!s.isLogin)return void c.login("store");a?i.panicBuyingSubmit():i.submit(),o.lockButton()}},panicBuyingSubmit:function(){function e(){n.ajax({url:_.remoteURL.getToken,type:"get",data:{itemId:f.modelData.itemId},dataType:"jsonp"}).done(function(e){e.success?(t.orderToken=e.data,t.panicBuyingStockStatus("buying"),_.closeOrderModal()):t.executeTokenException(e.errorCode||e.code)})}var t=this;if(t.orderToken)return void t.panicBuyingStockStatus("buying");try{e(),window.modalTimer=setTimeout(function(){_.orderDialog||_.startOrderModal()},1e3),window.tokenTimer=setInterval(function(){_.orderDialog||_.startOrderModal(),e()},2e3),window.stockWhenOrderTimer=setInterval(function(){t.panicBuyingStockStatus("ordering")},3e4)}catch(i){_.closeOrderModal()}},executeTokenException:function(e){var t=this;switch(e){case 401:_.closeOrderModal(),c.login("store");break;case 5002:_.closeOrderModal(),t.panicBuyingStockStatus()}},submit:function(){var e=this;e.validateRemote().done(function(){e.buyNow()}).fail(function(e){"login first"==e?c.login("store"):e&&w.message.html(e).addClass("error")})}}),_={remoteURL:{orderAdd:"//ordercenter.meizu.com/order/add.html",getStock:"//detail.meizu.com/api/sku/stock",getSaleStatus:"//detail.meizu.com/api/item/sale_status",getPanicBuyingStatus:"//detail.meizu.com/api/sku/sale_status",getToken:"//pyramid.meizu.com/queue/token"},parseCspuMap:function(e){var t,i=[];return e=e||f.modelData.cspuMap,n.each(e,function(e,a){var s=e.split(";");n.each(s,function(e,i){t=i.split(":"),a[t[0]]=t[1]}),a.id=e,a.pvs=e,i.push(a)}),i},startOrderModal:function(){var e=this;e.orderDialog=r({width:600,height:500,content:p,zIndex:1e5,onshow:function(){n("#J_DialogClose").on("click.dialog",function(){_.closeOrderModal()})},onclose:function(){_.closeOrderModal(),n("#J_DialogClose").off("click.dialog")},backdropOpacity:.4}).showModal()},closeOrderModal:function(){window.modalTimer&&clearTimeout(window.modalTimer),window.tokenTimer&&clearInterval(window.tokenTimer),window.stockWhenOrderTimer&&clearInterval(window.stockWhenOrderTimer),this.orderDialog&&(this.orderDialog.remove(),this.orderDialog=!1)},queryString:function(e){var t=location.search.match(new RegExp("[?&]"+e+"=([^&]*)(&?)","i"));return t?t[1]:""},getPvs:function(){var e,t=this.queryString("skuid");return e=t&&f.modelData.skuMap[t]?f.modelData.skuMap[t]:f.modelData.recommend},isComingSale:function(){var e=!1;return 1===f.modelData.type&&2===f.modelData.activeStatus&&(e=!0),e},getShowTime:function(){var e,t=f.modelData.shelveTime,i=new Date;return i.setTime(t),e=i.getMonth()+1+"月"+i.getDate()+"日 "+(i.getHours()>=10?i.getHours():"0"+i.getHours())+":"+(i.getMinutes()>=10?i.getMinutes():"0"+i.getMinutes())+" 准时开售"},getDiscountTime:function(e){var t=!1;e&&(t=Math.floor(e/86400)+"天"+Math.floor(e%86400/3600)+"时"+Math.floor(e%3600/60)+"分"+Math.floor(e%60)+"秒"),t&&w.discountCountDown.html("( 剩余<em>"+t+"</em> )")},getWaitingTime:function(e){var t,i,n=this,a=f.modelData.shelveTime,s=Number(w.serverTime.val());return e=e||0,t=Math.ceil((a-s)/1e3)-e,i=!(t<0)&&(t<7200?Math.floor(t/3600)+"时"+Math.floor(t%3600/60)+"分"+Math.floor(t%60)+"秒":n.getShowTime(a))}},window.livePropertyView=new y({el:"#property",model:new v({pvs:_.getPvs(),packageMap:g.packageMap,packageStock:g.packageStockMap,packageItems:g.packageItems,isPanicBuying:2===g.type,isPackage:!a.isEmpty(g.packageMap),discountKeys:g.discount?a.keys(g.discount.cspuMap):null}),collection:new k(_.parseCspuMap())}),f.modelData.supportFastArrival&&l.init(),d.init(f.modelData.itemId),u()},1,,,,,,,,,function(e,t){e.exports=meizuStoreGlobal.underscore},function(e,t){e.exports=meizuStoreGlobal},function(e,t,i){var n,a;(function(s){!function(o){var r="object"==typeof self&&self.self===self&&self||"object"==typeof s&&s.global===s&&s;n=[i(18),i(7),t],a=function(e,t,i){r.Backbone=o(r,i,e,t)}.apply(t,n),!(void 0!==a&&(e.exports=a))}(function(e,t,i,n){var a=e.Backbone,s=Array.prototype.slice;t.VERSION="1.3.3",t.$=n,t.noConflict=function(){return e.Backbone=a,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=function(e,t,n){switch(e){case 1:return function(){return i[t](this[n])};case 2:return function(e){return i[t](this[n],e)};case 3:return function(e,a){return i[t](this[n],c(e,this),a)};case 4:return function(e,a,s){return i[t](this[n],c(e,this),a,s)};default:return function(){var e=s.call(arguments);return e.unshift(this[n]),i[t].apply(i,e)}}},r=function(e,t,n){i.each(t,function(t,a){i[a]&&(e.prototype[a]=o(t,a,n))})},c=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?d(e):i.isString(e)?function(t){return t.get(e)}:e},d=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}},l=t.Events={},u=/\s+/,h=function(e,t,n,a,s){var o,r=0;if(n&&"object"==typeof n){void 0!==a&&"context"in s&&void 0===s.context&&(s.context=a);for(o=i.keys(n);r<o.length;r++)t=h(e,t,o[r],n[o[r]],s)}else if(n&&u.test(n))for(o=n.split(u);r<o.length;r++)t=e(t,o[r],a,s);else t=e(t,n,a,s);return t};l.on=function(e,t,i){return m(this,e,t,i)};var m=function(e,t,i,n,a){if(e._events=h(p,e._events||{},t,i,{context:n,ctx:e,listening:a}),a){var s=e._listeners||(e._listeners={});s[a.id]=a}return e};l.listenTo=function(e,t,n){if(!e)return this;var a=e._listenId||(e._listenId=i.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=s[a];if(!o){var r=this._listenId||(this._listenId=i.uniqueId("l"));o=s[a]={obj:e,objId:a,id:r,listeningTo:s,count:0}}return m(e,t,n,this,o),this};var p=function(e,t,i,n){if(i){var a=e[t]||(e[t]=[]),s=n.context,o=n.ctx,r=n.listening;r&&r.count++,a.push({callback:i,context:s,ctx:s||o,listening:r})}return e};l.off=function(e,t,i){return this._events?(this._events=h(f,this._events,e,t,{context:i,listeners:this._listeners}),this):this},l.stopListening=function(e,t,n){var a=this._listeningTo;if(!a)return this;for(var s=e?[e._listenId]:i.keys(a),o=0;o<s.length;o++){var r=a[s[o]];if(!r)break;r.obj.off(t,n,this)}return this};var f=function(e,t,n,a){if(e){var s,o=0,r=a.context,c=a.listeners;if(t||n||r){for(var d=t?[t]:i.keys(e);o<d.length;o++){t=d[o];var l=e[t];if(!l)break;for(var u=[],h=0;h<l.length;h++){var m=l[h];n&&n!==m.callback&&n!==m.callback._callback||r&&r!==m.context?u.push(m):(s=m.listening,s&&0===--s.count&&(delete c[s.id],delete s.listeningTo[s.objId]))}u.length?e[t]=u:delete e[t]}return e}for(var p=i.keys(c);o<p.length;o++)s=c[p[o]],delete c[s.id],delete s.listeningTo[s.objId]}};l.once=function(e,t,n){var a=h(g,{},e,t,i.bind(this.off,this));return"string"==typeof e&&null==n&&(t=void 0),this.on(a,t,n)},l.listenToOnce=function(e,t,n){var a=h(g,{},t,n,i.bind(this.stopListening,this,e));return this.listenTo(e,a)};var g=function(e,t,n,a){if(n){var s=e[t]=i.once(function(){a(t,s),n.apply(this,arguments)});s._callback=n}return e};l.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;n<t;n++)i[n]=arguments[n+1];return h(v,this._events,e,void 0,i),this};var v=function(e,t,i,n){if(e){var a=e[t],s=e.all;a&&s&&(s=s.slice()),a&&y(a,n),s&&y(s,[t].concat(n))}return e},y=function(e,t){var i,n=-1,a=e.length,s=t[0],o=t[1],r=t[2];switch(t.length){case 0:for(;++n<a;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<a;)(i=e[n]).callback.call(i.ctx,s);return;case 2:for(;++n<a;)(i=e[n]).callback.call(i.ctx,s,o);return;case 3:for(;++n<a;)(i=e[n]).callback.call(i.ctx,s,o,r);return;default:for(;++n<a;)(i=e[n]).callback.apply(i.ctx,t);return}};l.bind=l.on,l.unbind=l.off,i.extend(t,l);var b=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var a=i.result(this,"defaults");n=i.defaults(i.extend({},a,n),a),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(b.prototype,l,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var a;if("object"==typeof e?(a=e,n=t):(a={})[e]=t,n||(n={}),!this._validate(a,n))return!1;var s=n.unset,o=n.silent,r=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=i.clone(this.attributes),this.changed={});var d=this.attributes,l=this.changed,u=this._previousAttributes;for(var h in a)t=a[h],i.isEqual(d[h],t)||r.push(h),i.isEqual(u[h],t)?delete l[h]:l[h]=t,s?delete d[h]:d[h]=t;if(this.idAttribute in a&&(this.id=this.get(this.idAttribute)),!o){r.length&&(this._pending=n);for(var m=0;m<r.length;m++)this.trigger("change:"+r[m],this,d[r[m]],n)}if(c)return this;if(!o)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t=this._changing?this._previousAttributes:this.attributes,n={};for(var a in e){var s=e[a];i.isEqual(t[a],s)||(n[a]=s)}return!!i.size(n)&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var a=e.parse?t.parse(i,e):i;return!!t.set(a,e)&&(n&&n.call(e.context,t,i,e),void t.trigger("sync",t,i,e))},U(this,e),this.sync("read",this,e)},save:function(e,t,n){var a;null==e||"object"==typeof e?(a=e,n=t):(a={})[e]=t,n=i.extend({validate:!0,parse:!0},n);var s=n.wait;if(a&&!s){if(!this.set(a,n))return!1}else if(!this._validate(a,n))return!1;var o=this,r=n.success,c=this.attributes;n.success=function(e){o.attributes=c;var t=n.parse?o.parse(e,n):e;return s&&(t=i.extend({},a,t)),!(t&&!o.set(t,n))&&(r&&r.call(n.context,o,e,n),void o.trigger("sync",o,e,n))},U(this,n),a&&s&&(this.attributes=i.extend({},c,a));var d=this.isNew()?"create":n.patch?"patch":"update";"patch"!==d||n.attrs||(n.attrs=a);var l=this.sync(d,this,n);return this.attributes=c,l},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,a=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){a&&s(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var o=!1;return this.isNew()?i.defer(e.success):(U(this,e),o=this.sync("delete",this,e)),a||s(),o},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||O();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});var k={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};r(b,k,"attributes");var _=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},w={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},S=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var n,a=Array(e.length-i),s=t.length;for(n=0;n<a.length;n++)a[n]=e[n+i];for(n=0;n<s;n++)e[n+i]=t[n];for(n=0;n<a.length;n++)e[n+s+i]=a[n]};i.extend(_.prototype,l,{model:b,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,x))},remove:function(e,t){
t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:e.slice();var a=this._removeModels(e,t);return!t.silent&&a.length&&(t.changes={added:[],merged:[],removed:a},this.trigger("update",this,t)),n?a[0]:a},set:function(e,t){if(null!=e){t=i.extend({},w,t),t.parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!i.isArray(e);e=n?[e]:e.slice();var a=t.at;null!=a&&(a=+a),a>this.length&&(a=this.length),a<0&&(a+=this.length+1);var s,o,r=[],c=[],d=[],l=[],u={},h=t.add,m=t.merge,p=t.remove,f=!1,g=this.comparator&&null==a&&t.sort!==!1,v=i.isString(this.comparator)?this.comparator:null;for(o=0;o<e.length;o++){s=e[o];var y=this.get(s);if(y){if(m&&s!==y){var b=this._isModel(s)?s.attributes:s;t.parse&&(b=y.parse(b,t)),y.set(b,t),d.push(y),g&&!f&&(f=y.hasChanged(v))}u[y.cid]||(u[y.cid]=!0,r.push(y)),e[o]=y}else h&&(s=e[o]=this._prepareModel(s,t),s&&(c.push(s),this._addReference(s,t),u[s.cid]=!0,r.push(s)))}if(p){for(o=0;o<this.length;o++)s=this.models[o],u[s.cid]||l.push(s);l.length&&this._removeModels(l,t)}var k=!1,_=!g&&h&&p;if(r.length&&_?(k=this.length!==r.length||i.some(this.models,function(e,t){return e!==r[t]}),this.models.length=0,S(this.models,r,0),this.length=this.models.length):c.length&&(g&&(f=!0),S(this.models,c,null==a?this.length:a),this.length=this.models.length),f&&this.sort({silent:!0}),!t.silent){for(o=0;o<c.length;o++)null!=a&&(t.index=a+o),s=c[o],s.trigger("add",s,this,t);(f||k)&&this.trigger("sort",this,t),(c.length||l.length||d.length)&&(t.changes={added:c,removed:l,merged:d},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return s.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(e.attributes||e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=i.bind(t,this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){e=i.extend({parse:!0},e);var t=e.success,n=this;return e.success=function(i){var a=e.reset?"reset":"set";n[a](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},U(this,e),this.sync("read",this,e)},create:function(e,t){t=t?i.clone(t):{};var n=t.wait;if(e=this._prepareModel(e,t),!e)return!1;n||this.add(e,t);var a=this,s=t.success;return t.success=function(e,t,i){n&&a.add(e,i),s&&s.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?i.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var a=this.get(e[n]);if(a){var s=this.indexOf(a);this.models.splice(s,1),this.length--,delete this._byId[a.cid];var o=this.modelId(a.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=s,a.trigger("remove",a,this,t)),i.push(a),this._removeReference(a,t)}}return i},_isModel:function(e){return e instanceof b},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,n),"change"===e){var a=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);a!==s&&(null!=a&&delete this._byId[a],null!=s&&(this._byId[s]=t))}}this.trigger.apply(this,arguments)}});var C={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};r(_,C,"models");var T=t.View=function(e){this.cid=i.uniqueId("view"),i.extend(this,i.pick(e,P)),this._ensureElement(),this.initialize.apply(this,arguments)},I=/^(\S+)\s*(.*)$/,P=["model","collection","el","id","attributes","className","tagName","events"];i.extend(T.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var a=t.match(I);this.delegate(a[1],a[2],i.bind(n,this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e["class"]=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,n,a){var s=A[e];i.defaults(a||(a={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};if(a.url||(o.url=i.result(n,"url")||O()),null!=a.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(a.attrs||n.toJSON(a))),a.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),a.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",a.emulateJSON&&(o.data._method=s);var r=a.beforeSend;a.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",s),r)return r.apply(this,arguments)}}"GET"===o.type||a.emulateJSON||(o.processData=!1);var c=a.error;a.error=function(e,t,i){a.textStatus=t,a.errorThrown=i,c&&c.call(a.context,e,t,i)};var d=a.xhr=t.ajax(i.extend(o,a));return n.trigger("request",n,d,a),d};var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var D=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},j=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,E=/\*\w+/g,M=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(D.prototype,l,{initialize:function(){},route:function(e,n,a){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(a=n,n=""),a||(a=this[n]);var s=this;return t.history.route(e,function(i){var o=s._extractParameters(e,i);s.execute(a,o,n)!==!1&&(s.trigger.apply(s,["route:"+n].concat(o)),s.trigger("route",n,o),t.history.trigger("route",s,n,o))}),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(M,"\\$&").replace(j,"(?:$1)?").replace(B,function(e,t){return t?e:"([^/?]+)"}).replace(E,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var N=t.History=function(){this.handlers=[],this.checkUrl=i.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},L=/^[#\/]|\s+$/g,$=/^\/+|\/+$/g,q=/#.*$/;N.started=!1,i.extend(N.prototype,l,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(L,"")},start:function(e){if(N.started)throw new Error("Backbone.history has already been started");if(N.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace($,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,a=n.insertBefore(this.iframe,n.firstChild).contentWindow;a.document.open(),a.document.close(),a.location.hash="#"+this.fragment}var s=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),N.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t!==this.fragment&&(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),i.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(e,t){if(!N.started)return!1;t&&t!==!0||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;""!==e&&"?"!==e.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+e;if(e=this.decodeFragment(e.replace(q,"")),this.fragment!==e){if(this.fragment=e,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var a=this.iframe.contentWindow;t.replace||(a.document.open(),a.document.close()),this._updateHash(a.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new N;var J=function(e,t){var n,a=this;return n=e&&i.has(e,"constructor")?e.constructor:function(){return a.apply(this,arguments)},i.extend(n,a,t),n.prototype=i.create(a.prototype,e),n.prototype.constructor=n,n.__super__=a.prototype,n};b.extend=_.extend=D.extend=T.extend=N.extend=J;var O=function(){throw new Error('A "url" property or function must be specified')},U=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t})}).call(t,function(){return this}())},function(e,t,i){var n=i(7);!function(){function e(t){var n=i[t],a="exports";return"object"==typeof n?n:(n[a]||(n[a]={},n[a]=n.call(n[a],e,n[a],n)||n[a]),n[a])}function t(e,t){i[e]=t}var i={};t("jquery",function(){return n}),t("popup",function(e){function t(){this.destroyed=!1,this.__popup=i("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body"),this.__backdrop=this.__mask=i("<div />").css({opacity:.7,background:"#000"}),this.node=this.__popup[0],this.backdrop=this.__backdrop[0],n++}var i=e("jquery"),n=0,a=!("minWidth"in i("html")[0].style),s=!a;return i.extend(t.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",innerHTML:"",className:"ui-popup",show:function(e){if(this.destroyed)return this;var n=this.__popup,o=this.__backdrop;if(this.__activeElement=this.__getActive(),this.open=!0,this.follow=e||this.follow,!this.__ready){if(n.addClass(this.className).attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute"),a||i(window).on("resize",i.proxy(this.reset,this)),this.modal){var r={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||t.zIndex};n.addClass(this.className+"-modal"),s||i.extend(r,{position:"absolute",width:i(window).width()+"px",height:i(document).height()+"px"}),o.css(r).attr({tabindex:"0"}).on("focus",i.proxy(this.focus,this)),this.__mask=o.clone(!0).attr("style","").insertAfter(n),o.addClass(this.className+"-backdrop").insertBefore(n),this.__ready=!0}n.html()||n.html(this.innerHTML)}return n.addClass(this.className+"-show").show(),o.show(),this.reset().focus(),this.__dispatchEvent("show"),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(e){return!this.destroyed&&this.open&&(void 0!==e&&(this.returnValue=e),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove"),t.current===this&&(t.current=null),this.__popup.remove(),this.__backdrop.remove(),this.__mask.remove(),a||i(window).off("resize",this.reset),this.__dispatchEvent("remove");for(var e in this)delete this[e];return this},reset:function(){var e=this.follow;return e?this.__follow(e):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var e=this.node,n=this.__popup,a=t.current,s=this.zIndex=t.zIndex++;if(a&&a!==this&&a.blur(!1),!i.contains(e,this.__getActive())){var o=n.find("[autofocus]")[0];!this._autofocus&&o?this._autofocus=!0:o=e,this.__focus(o)}return n.css("zIndex",s),t.current=this,n.addClass(this.className+"-focus"),this.__dispatchEvent("focus"),this},blur:function(){var e=this.__activeElement,t=arguments[0];return t!==!1&&this.__focus(e),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(e,t){return this.__getEventListener(e).push(t),this},removeEventListener:function(e,t){for(var i=this.__getEventListener(e),n=0;n<i.length;n++)t===i[n]&&i.splice(n--,1);return this},__getEventListener:function(e){var t=this.__listener;return t||(t=this.__listener={}),t[e]||(t[e]=[]),t[e]},__dispatchEvent:function(e){var t=this.__getEventListener(e);this["on"+e]&&this["on"+e]();for(var i=0;i<t.length;i++)t[i].call(this)},__focus:function(e){try{this.autofocus&&!/^iframe$/i.test(e.nodeName)&&e.focus()}catch(t){}},__getActive:function(){try{var e=document.activeElement,t=e.contentDocument,i=t&&t.activeElement||e;return i}catch(n){}},__center:function(){var e=this.__popup,t=i(window),n=i(document),a=this.fixed,s=a?0:n.scrollLeft(),o=a?0:n.scrollTop(),r=t.width(),c=t.height(),d=e.width(),l=e.height(),u=(r-d)/2+s,h=382*(c-l)/1e3+o,m=e[0].style;m.left=Math.max(parseInt(u),s)+"px",m.top=Math.max(parseInt(h),o)+"px"},__follow:function(e){var t=e.parentNode&&i(e),n=this.__popup;if(this.__followSkin&&n.removeClass(this.__followSkin),t){var a=t.offset();if(a.left*a.top<0)return this.__center()}var s=this,o=this.fixed,r=i(window),c=i(document),d=r.width(),l=r.height(),u=c.scrollLeft(),h=c.scrollTop(),m=n.width(),p=n.height(),f=t?t.outerWidth():0,g=t?t.outerHeight():0,v=this.__offset(e),y=v.left,b=v.top,k=o?y-u:y,_=o?b-h:b,w=o?0:u,x=o?0:h,S=w+d-m,C=x+l-p,T={},I=this.align.split(" "),P=this.className+"-",A={top:"bottom",bottom:"top",left:"right",right:"left"},D={top:"top",bottom:"top",left:"left",right:"left"},j=[{top:_-p,bottom:_+g,left:k-m,right:k+f},{top:_,bottom:_-p+g,left:k,right:k-m+f}],B={left:k+f/2-m/2,top:_+g/2-p/2},E={left:[w,S],top:[x,C]};i.each(I,function(e,t){j[e][t]>E[D[t]][1]&&(t=I[e]=A[t]),j[e][t]<E[D[t]][0]&&(I[e]=A[t])}),I[1]||(D[I[1]]="left"===D[I[0]]?"top":"left",j[1][I[1]]=B[D[I[1]]]),P+=I.join("-")+" "+this.className+"-follow",s.__followSkin=P,t&&n.addClass(P),T[D[I[0]]]=parseInt(j[0][I[0]]),T[D[I[1]]]=parseInt(j[1][I[1]]),n.css(T)},__offset:function(e){var t=e.parentNode,n=t?i(e).offset():{left:e.pageX,top:e.pageY};e=t?e:e.target;var a=e.ownerDocument,s=a.defaultView||a.parentWindow;if(s==window)return n;var o=s.frameElement,r=i(a),c=r.scrollLeft(),d=r.scrollTop(),l=i(o).offset(),u=l.left,h=l.top;return{left:n.left+u-c,top:n.top+h-d}}}),t.zIndex=1024,t.current=null,t}),t("dialog-config",{backdropBackground:"#000",backdropOpacity:.7,content:'<span class="ui-dialog-loading">Loading..</span>',title:"",statusbar:"",button:null,ok:null,cancel:null,okValue:"ok",cancelValue:"cancel",cancelDisplay:!0,width:"",height:"",padding:"",skin:"",quickClose:!1,cssUri:"../css/ui-dialog.css",innerHTML:'<div i="dialog" class="ui-dialog"><div class="ui-dialog-arrow-a"></div><div class="ui-dialog-arrow-b"></div><table class="ui-dialog-grid"><tr><td i="header" class="ui-dialog-header"><button i="close" class="ui-dialog-close">&#215;</button><div i="title" class="ui-dialog-title"></div></td></tr><tr><td i="body" class="ui-dialog-body"><div i="content" class="ui-dialog-content"></div></td></tr><tr><td i="footer" class="ui-dialog-footer"><div i="statusbar" class="ui-dialog-statusbar"></div><div i="button" class="ui-dialog-button"></div></td></tr></table></div>'}),t("dialog",function(e){var t=e("jquery"),i=e("popup"),n=e("dialog-config"),a=n.cssUri;if(a){var s=e[e.toUrl?"toUrl":"resolve"];s&&(a=s(a),a='<link rel="stylesheet" href="'+a+'" />',t("base")[0]?t("base").before(a):t("head").append(a))}var o=0,r=new Date-0,c=!("minWidth"in t("html")[0].style),d="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),l=!c&&!d,u=function(e,i,n){var a=e=e||{};("string"==typeof e||1===e.nodeType)&&(e={content:e,fixed:!d}),e=t.extend(!0,{},u.defaults,e),e.original=a;var s=e.id=e.id||r+o,c=u.get(s);return c?c.focus():(l||(e.fixed=!1),e.quickClose&&(e.modal=!0,e.backdropOpacity=0),t.isArray(e.button)||(e.button=[]),void 0!==n&&(e.cancel=n),e.cancel&&e.button.push({id:"cancel",value:e.cancelValue,callback:e.cancel,display:e.cancelDisplay}),void 0!==i&&(e.ok=i),e.ok&&e.button.push({id:"ok",value:e.okValue,callback:e.ok,autofocus:!0}),u.list[s]=new u.create(e))},h=function(){};h.prototype=i.prototype;var m=u.prototype=new h;return u.create=function(e){var n=this;t.extend(this,new i);var a=(e.original,t(this.node).html(e.innerHTML)),s=t(this.backdrop);return this.options=e,this._popup=a,t.each(e,function(e,t){"function"==typeof n[e]?n[e](t):n[e]=t}),e.zIndex&&(i.zIndex=e.zIndex),a.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content:"+this.id).attr("id")}),this._$("close").css("display",this.cancel===!1?"none":"").attr("title",this.cancelValue).on("click",function(e){n._trigger("cancel"),e.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),e.quickClose&&s.on("onmousedown"in document?"mousedown":"click",function(){return n._trigger("cancel"),!1}),this.addEventListener("show",function(){s.css({opacity:0,background:e.backdropBackground}).animate({opacity:e.backdropOpacity},150)}),this._esc=function(e){var t=e.target,a=t.nodeName,s=/^input|textarea$/i,o=i.current===n,r=e.keyCode;!o||s.test(a)&&"button"!==t.type||27===r&&n._trigger("cancel")},t(document).on("keydown",this._esc),this.addEventListener("remove",function(){t(document).off("keydown",this._esc),delete u.list[this.id]}),o++,u.oncreate(this),this},u.create.prototype=m,t.extend(m,{content:function(e){var i=this._$("content");return"object"==typeof e?(e=t(e),i.empty("").append(e.show()),this.addEventListener("beforeremove",function(){t("body").append(e.hide())})):i.html(e),this.reset()},title:function(e){return this._$("title").text(e),this._$("header")[e?"show":"hide"](),this},width:function(e){return this._$("content").css("width",e),this.reset()},height:function(e){return this._$("content").css("height",e),this.reset()},button:function(e){e=e||[];var i=this,n="",a=0;return this.callbacks={},"string"==typeof e?(n=e,a++):t.each(e,function(e,s){var o=s.id=s.id||s.value,r="";i.callbacks[o]=s.callback,s.display===!1?r=' style="display:none"':a++,n+='<button type="button" i-id="'+o+'"'+r+(s.disabled?" disabled":"")+(s.autofocus?' autofocus class="ui-dialog-autofocus"':"")+">"+s.value+"</button>",i._$("button").on("click","[i-id="+o+"]",function(e){var n=t(this);n.attr("disabled")||i._trigger(o),e.preventDefault()})}),this._$("button").html(n),this._$("footer")[a?"show":"hide"](),this},statusbar:function(e){return this._$("statusbar").html(e)[e?"show":"hide"](),this},_$:function(e){return this._popup.find("[i="+e+"]")},_trigger:function(e){var t=this.callbacks[e];return"function"!=typeof t||t.call(this)!==!1?this.close().remove():this}}),u.oncreate=t.noop,u.getCurrent=function(){return i.current},u.get=function(e){return void 0===e?u.list:u.list[e]},u.list={},u.defaults=n,u}),window.dialog=e("dialog")}()},function(e,t,i){var n,a,s,o=i(7);a=function(e,t,i,n){var a=Math.ceil((t-e)/1e3),s=setInterval(function(){a<=0?(n&&n(),clearInterval(s)):i&&i(a),a--},1e3)},n=function(e){var t,i={store:"http://store.meizu.com/member/login.htm?",mall:"http://mall.meizu.com/member/login.html?"},n="https://login.flyme.cn/vCodeLogin?";i[e]&&(t={useruri:i[e]+"useruri="+location.href,service:"store",sid:"unionlogin",autodirct:!0},location.href=n+o.param(t))},s=function(e,t,i,n){var a=o.Deferred();return o.ajax({url:e,data:t||null,type:i||"get",dataType:n||"jsonp",timeout:4e3,cache:!1}).done(function(e){e.success?a.resolve(e.data):a.reject(e)}).fail(function(){a.reject("网络异常，请稍后再试!")}),a.promise()},e.exports={ajax:s,login:n,countDown:a}},function(e,t,i){var n=i(7),a=i(18),s=i(24),o={promoInner:n("#J_promoInner"),discountCouponList:n("#J_discountCoupon")},r={remoteURL:{getCouponList:"//promotion.meizu.com/coupon/item/list/",getCoupon:"//promotion.meizu.com/coupon/acquire/"},init:function(e){var t=this;t.getCoupon(e),t.bindEvent()},bindEvent:function(){var e=this;n("#J_promoInner,#J_promoMore").on("click",function(){n("#layerPromo").fadeIn(100)}),n("#J_discountCoupon").on("click",".vm-btn",function(t){var i=n(t.currentTarget),a=i.data("key");i.hasClass("disabled")||(e.ajax(e.remoteURL.getCoupon+a,null,"get","jsonp").done(function(){e.artAlert("您已领取成功，已领取的优惠券可在会员中心我的优惠券进行查看！")}).fail(function(t){401===t.code?e.artAlert("请先登录!"):e.artAlert(t.message)}),t.preventDefault(),t.stopPropagation(),i.addClass("disabled"),window.setTimeout(function(){i.removeClass("disabled")},1e3))}),n("#J_promoClose").on("click",function(){n("#layerPromo").fadeOut(200)})},getCoupon:function(e){var t=this,i=t.remoteURL.getCouponList+e;t.ajax(i,{scope:3},"get","jsonp").done(function(e){e&&e.length&&(e=t.formatData(e),t.renderCoupon(e))})},formatData:function(e){var t=function(e){var t=new Date(e),i=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),s=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return i+"."+n+"."+a+" "+s+":"+o};return n.each(e,function(e,i){i.start=t(i.start),i.end=t(i.end)}),e},renderCoupon:function(e){var t,i,r="";e&&(n.each(e,function(e,t){if(r+=1===t.couponType?'<span class="vm-tag"><em>满'+t.consumptionQuota+"减"+t.reductionQuota+"</em></span>":'<span class="vm-tag multiple"><em>满'+t.consumptionQuota+"减"+t.reductionQuota+"</em></span>",2===e)return!1}),t=a.template(s),i=t({listData:e}),o.promoInner.append(r).parent().parent().slideDown(200),o.discountCouponList.append(i))},ajax:function(e,t,i,a){var s=n.Deferred();return n.ajax({url:e,type:i||"get",data:t||null,dataType:a||"json",timeout:4e3,cache:!1}).done(function(e){e.success?s.resolve(e.data):s.reject(e)}).fail(function(){s.reject("网络异常，请稍后再试!")}),s.promise()},artAlert:function(e){var t=this,i='<div class="bi-alert" id="couponAlert"><div class="bi-alert-bd">'+e+"</div></div>";t.instance&&t.instance.remove(),t.instance=n(i).appendTo("#layerPromo").addClass("bi-show"),setTimeout(function(){t.instance.remove()},2e3)}};e.exports=r},function(e,t){e.exports='<% for(var i = 0, length = listData.length; i < length; i++) { %>\n    <dd class="discount-coupon-item <% if (listData[i].couponType === 2) { %>multiple<% } %>">\n        <div class="mod-btn">\n            <a class="vm-btn" data-key="<%= listData[i].couponKey %>">立即领取</a>\n        </div>\n        <div class="mod-bd">\n            <p class="mod-bd-view">\n                <span class="vm-amount"><sup>¥</sup><%= listData[i].reductionQuota %></span>\n                <em>\n                <% if (listData[i].couponType === 1) { %>\n                (单品券)\n                <% } else { %>\n                (多品券)\n                <% } %>\n                </em>\n            </p>\n            <h3 class="ellipsis"><%= listData[i].couponName %>优惠券</h3>\n            <h5>满<%= listData[i].consumptionQuota %>元使用</h5>\n        </div>\n        <div class="mod-info">\n            <p><%= listData[i].start %>－<%= listData[i].end %></p>\n            <p class="vm-range ellipsis">适用范围：<%= listData[i].appliableDesc %></p>\n            <% if (listData[i].couponType === 2) { %>\n            <a class="vm-more" target="_blank" href="//lists.meizu.com/page/couponItems/<%= listData[i].couponGroupId %>.html">查看适用></a>\n            <% } %>\n        </div>\n    </dd>\n<% } %>'},function(e,t,i){var n=i(7),a=i(18);i(26);var s={sort:[2911,14848,7450,8452,16860,1,16624,18482,21612,41143,42634,36793,15121,1214,27304,35714,34187,23366,20238,32166,11241,38498,21894,3251,10088,25024,25305,13289,25761,32939,5700],provinceAndCities:{2911:{id:2911,name:"北京",cities:[{id:2912,name:"北京市"}]},14848:{id:14848,name:"天津",cities:[{id:14849,name:"天津市"}]},7450:{id:7450,name:"吉林省",cities:[{id:7451,name:"长春市"},{id:7632,name:"吉林市"},{id:7787,name:"延边朝鲜族自治州"},{id:7901,name:"四平市"},{id:8011,name:"通化市"},{id:8117,name:"白城市"},{id:8222,name:"辽源市"},{id:8272,name:"松原市"},{id:8378,name:"白山市"}]},8452:{id:8452,name:"辽宁省",cities:[{id:8453,name:"大连市"},{id:8627,name:"丹东市"},{id:8724,name:"沈阳市"},{id:8951,name:"抚顺市"},{id:9043,name:"铁岭市"},{id:9156,name:"鞍山市"},{id:9277,name:"本溪市"},{id:9342,name:"锦州市"},{id:9465,name:"营口市"},{id:9544,name:"阜新市"},{id:9648,name:"辽阳市"},{id:9717,name:"朝阳市"},{id:9892,name:"盘锦市"},{id:9954,name:"葫芦岛市"}]},16860:{id:16860,name:"浙江省",cities:[{id:16861,name:"杭州市"},{id:17072,name:"湖州市"},{id:17146,name:"嘉兴市"},{id:17227,name:"衢州市"},{id:17343,name:"丽水市"},{id:17535,name:"金华市"},{id:17697,name:"宁波市"},{id:17861,name:"舟山市"},{id:17909,name:"绍兴市"},{id:18035,name:"台州市"},{id:18179,name:"温州市"}]},1:{id:1,name:"福建省",cities:[{id:2,name:"福州市"},{id:208,name:"宁德市"},{id:347,name:"三明市"},{id:502,name:"南平市"},{id:652,name:"莆田市"},{id:712,name:"泉州市"},{id:888,name:"厦门市"},{id:933,name:"漳州市"},{id:1073,name:"龙岩市"}]},16624:{id:16624,name:"上海",cities:[{id:16625,name:"上海市"}]},18482:{id:18482,name:"广东省",cities:[{id:18483,name:"汕尾市"},{id:18547,name:"揭阳市"},{id:18641,name:"汕头市"},{id:18718,name:"潮州市"},{id:18773,name:"东莞市"},{id:18807,name:"佛山市"},{id:18846,name:"肇庆市"},{id:18964,name:"云浮市"},{id:19033,name:"广州市"},{id:19209,name:"韶关市"},{id:19327,name:"清远市"},{id:19422,name:"惠州市"},{id:19499,name:"梅州市"},{id:19622,name:"河源市"},{id:19729,name:"深圳市"},{id:19796,name:"阳江市"},{id:19848,name:"茂名市"},{id:19964,name:"江门市"},{id:20052,name:"湛江市"},{id:20184,name:"珠海市"},{id:20212,name:"中山市"}]},21612:{id:21612,name:"海南省",cities:[{id:21613,name:"海口市"},{id:21661,name:"琼海市"},{id:21675,name:"儋州市"},{id:21705,name:"文昌市"},{id:21724,name:"定安县"},{id:21736,name:"屯昌县"},{id:21746,name:"澄迈县"},{id:21759,name:"临高县"},{id:21771,name:"白沙黎族自治县"},{id:21784,name:"昌江黎族自治县"},{id:21794,name:"陵水黎族自治县"},{id:21807,name:"保亭黎族苗族自治县"},{id:21818,name:"琼中黎族苗族自治县"},{id:21830,name:"三亚市"},{id:21840,name:"五指山市"},{id:21849,name:"万宁市"},{id:21864,name:"东方市"},{id:21876,name:"乐东黎族自治县"},{id:21889,name:"三沙市"}]},41143:{id:41143,name:"湖北省",cities:[{id:41144,name:"武汉市"},{id:41336,name:"襄阳市"},{id:41457,name:"鄂州市"},{id:41486,name:"孝感市"},{id:41620,name:"黄冈市"},{id:41774,name:"黄石市"},{id:41835,name:"咸宁市"},{id:41919,name:"荆州市"},{id:42055,name:"宜昌市"},{id:42180,name:"恩施土家族苗族自治州"},{id:42280,name:"十堰市"},{id:42420,name:"神农架"},{id:42430,name:"随州市"},{id:42481,name:"荆门市"},{id:42555,name:"仙桃市"},{id:42579,name:"潜江市"},{id:42604,name:"天门市"}]},42634:{id:42634,name:"湖南省",cities:[{id:42635,name:"岳阳市"},{id:42835,name:"长沙市"},{id:43035,name:"湘潭市"},{id:43126,name:"株洲市"},{id:43271,name:"衡阳市"},{id:43509,name:"郴州市"},{id:43728,name:"常德市"},{id:43978,name:"益阳市"},{id:44087,name:"娄底市"},{id:44190,name:"邵阳市"},{id:44427,name:"湘西土家族苗族自治州"},{id:44603,name:"张家界市"},{id:44713,name:"怀化市"},{id:45025,name:"永州市"}]},36793:{id:36793,name:"安徽省",cities:[{id:36794,name:"滁州市"},{id:36921,name:"合肥市"},{id:37075,name:"蚌埠市"},{id:37163,name:"芜湖市"},{id:37247,name:"淮南市"},{id:37321,name:"马鞍山市"},{id:37380,name:"安庆市"},{id:37567,name:"宿州市"},{id:37682,name:"阜阳市"},{id:37864,name:"亳州市"},{id:37960,name:"黄山市"},{id:38075,name:"淮北市"},{id:38116,name:"铜陵市"},{id:38150,name:"宣城市"},{id:38256,name:"六安市"},{id:38436,name:"池州市"}]},15121:{id:15121,name:"江苏省",cities:[{id:15122,name:"南京市"},{id:15238,name:"镇江市"},{id:15303,name:"扬州市"},{id:15406,name:"南通市"},{id:15534,name:"泰州市"},{id:15644,name:"盐城市"},{id:15794,name:"徐州市"},{id:15973,name:"淮安市"},{id:16129,name:"连云港市"},{id:16230,name:"宿迁市"},{id:16352,name:"苏州市"},{id:16469,name:"无锡市"},{id:16558,name:"常州市"}]},1214:{id:1214,name:"江西省",cities:[{id:1215,name:"鹰潭市"},{id:1261,name:"新余市"
},{id:1295,name:"南昌市"},{id:1428,name:"九江市"},{id:1642,name:"上饶市"},{id:1862,name:"抚州市"},{id:2039,name:"宜春市"},{id:2244,name:"吉安市"},{id:2482,name:"赣州市"},{id:2792,name:"景德镇市"},{id:2850,name:"萍乡市"}]},27304:{id:27304,name:"四川省",cities:[{id:27305,name:"成都市"},{id:27640,name:"眉山市"},{id:27778,name:"资阳市"},{id:27959,name:"攀枝花市"},{id:28025,name:"自贡市"},{id:28140,name:"绵阳市"},{id:28443,name:"南充市"},{id:28870,name:"达州市"},{id:29192,name:"遂宁市"},{id:29316,name:"广安市"},{id:29504,name:"巴中市"},{id:29702,name:"泸州市"},{id:29852,name:"宜宾市"},{id:30049,name:"内江市"},{id:30176,name:"乐山市"},{id:30407,name:"凉山彝族自治州"},{id:31038,name:"雅安市"},{id:31200,name:"甘孜藏族自治州"},{id:31543,name:"阿坝藏族羌族自治州"},{id:31780,name:"德阳市"},{id:31914,name:"广元市"}]},35714:{id:35714,name:"重庆",cities:[{id:35715,name:"重庆市"}]},34187:{id:34187,name:"云南省",cities:[{id:34188,name:"怒江傈僳族自治州"},{id:34222,name:"丽江市"},{id:34291,name:"西双版纳傣族自治州"},{id:34330,name:"德宏傣族景颇族自治州"},{id:34388,name:"昭通市"},{id:34543,name:"昆明市"},{id:34696,name:"大理白族自治州"},{id:34821,name:"红河哈尼族彝族自治州"},{id:34968,name:"曲靖市"},{id:35093,name:"保山市"},{id:35171,name:"文山壮族苗族自治州"},{id:35282,name:"玉溪市"},{id:35367,name:"楚雄彝族自治州"},{id:35481,name:"普洱市"},{id:35595,name:"临沧市"},{id:35681,name:"迪庆藏族自治州"}]},23366:{id:23366,name:"贵州省",cities:[{id:23367,name:"遵义市"},{id:23625,name:"安顺市"},{id:23719,name:"贵阳市"},{id:23856,name:"黔南布依族苗族自治州"},{id:24109,name:"黔东南苗族侗族自治州"},{id:24335,name:"铜仁市"},{id:24515,name:"毕节市"},{id:24776,name:"六盘水市"},{id:24879,name:"黔西南布依族苗族自治州"}]},20238:{id:20238,name:"广西壮族自治区",cities:[{id:20239,name:"防城港市"},{id:20271,name:"南宁市"},{id:20410,name:"崇左市"},{id:20494,name:"柳州市"},{id:20621,name:"来宾市"},{id:20698,name:"桂林市"},{id:20862,name:"梧州市"},{id:20936,name:"贺州市"},{id:21003,name:"贵港市"},{id:21083,name:"玉林市"},{id:21200,name:"百色市"},{id:21348,name:"钦州市"},{id:21426,name:"河池市"},{id:21577,name:"北海市"}]},32166:{id:32166,name:"西藏自治区",cities:[{id:32167,name:"拉萨市"},{id:32241,name:"日喀则地区"},{id:32463,name:"山南地区"},{id:32558,name:"林芝地区"},{id:32620,name:"昌都地区"},{id:32770,name:"那曲地区"},{id:32895,name:"阿里地区"}]},11241:{id:11241,name:"山东省",cities:[{id:11242,name:"菏泽市"},{id:11420,name:"济南市"},{id:11560,name:"淄博市"},{id:11679,name:"德州市"},{id:11825,name:"济宁市"},{id:11994,name:"泰安市"},{id:12087,name:"滨州市"},{id:12186,name:"东营市"},{id:12234,name:"莱芜市"},{id:12257,name:"聊城市"},{id:12401,name:"青岛市"},{id:12584,name:"临沂市"},{id:12777,name:"枣庄市"},{id:12848,name:"日照市"},{id:12909,name:"烟台市"},{id:13078,name:"潍坊市"},{id:13210,name:"威海市"}]},38498:{id:38498,name:"河南省",cities:[{id:38499,name:"商丘市"},{id:38699,name:"郑州市"},{id:38899,name:"安阳市"},{id:39045,name:"新乡市"},{id:39213,name:"许昌市"},{id:39321,name:"平顶山市"},{id:39476,name:"信阳市"},{id:39698,name:"南阳市"},{id:39950,name:"开封市"},{id:40085,name:"洛阳市"},{id:40292,name:"焦作市"},{id:40407,name:"济源市"},{id:40425,name:"鹤壁市"},{id:40474,name:"濮阳市"},{id:40570,name:"周口市"},{id:40787,name:"漯河市"},{id:40848,name:"驻马店市"},{id:41056,name:"三门峡市"}]},21894:{id:21894,name:"甘肃省",cities:[{id:21895,name:"临夏回族自治州"},{id:22034,name:"兰州市"},{id:22160,name:"定西市"},{id:22289,name:"平凉市"},{id:22412,name:"庆阳市"},{id:22541,name:"金昌市"},{id:22562,name:"武威市"},{id:22668,name:"张掖市"},{id:22741,name:"嘉峪关市"},{id:22753,name:"酒泉市"},{id:22839,name:"天水市"},{id:22970,name:"陇南市"},{id:23174,name:"甘南藏族自治州"},{id:23282,name:"白银市"}]},3251:{id:3251,name:"河北省",cities:[{id:3252,name:"张家口市"},{id:3507,name:"承德市"},{id:3734,name:"邯郸市"},{id:3996,name:"石家庄市"},{id:4296,name:"保定市"},{id:4663,name:"衡水市"},{id:4796,name:"邢台市"},{id:5012,name:"唐山市"},{id:5268,name:"廊坊市"},{id:5387,name:"沧州市"},{id:5595,name:"秦皇岛市"}]},10088:{id:10088,name:"内蒙古自治区",cities:[{id:10089,name:"赤峰市"},{id:10260,name:"呼伦贝尔市"},{id:10391,name:"兴安盟"},{id:10455,name:"呼和浩特市"},{id:10549,name:"包头市"},{id:10650,name:"乌海市"},{id:10676,name:"乌兰察布市"},{id:10793,name:"鄂尔多斯市"},{id:10881,name:"巴彦淖尔市"},{id:10973,name:"锡林郭勒盟"},{id:11071,name:"阿拉善盟"},{id:11110,name:"通辽市"}]},25024:{id:25024,name:"宁夏回族自治区",cities:[{id:25025,name:"银川市"},{id:25089,name:"石嘴山市"},{id:25130,name:"吴忠市"},{id:25186,name:"固原市"},{id:25258,name:"中卫市"}]},25305:{id:25305,name:"青海省",cities:[{id:25306,name:"海北藏族自治州"},{id:25342,name:"西宁市"},{id:25422,name:"海东市"},{id:25523,name:"黄南藏族自治州"},{id:25560,name:"海南藏族自治州"},{id:25603,name:"果洛藏族自治州"},{id:25654,name:"玉树藏族自治州"},{id:25707,name:"海西蒙古族藏族自治州"}]},13289:{id:13289,name:"山西省",cities:[{id:13290,name:"朔州市"},{id:13374,name:"忻州市"},{id:13581,name:"太原市"},{id:13697,name:"大同市"},{id:13852,name:"阳泉市"},{id:13903,name:"晋中市"},{id:14056,name:"长治市"},{id:14223,name:"晋城市"},{id:14317,name:"临汾市"},{id:14507,name:"吕梁市"},{id:14683,name:"运城市"}]},25761:{id:25761,name:"陕西省",cities:[{id:25762,name:"西安市"},{id:25952,name:"咸阳市"},{id:26124,name:"延安市"},{id:26264,name:"榆林市"},{id:26462,name:"渭南市"},{id:26618,name:"商洛市"},{id:26752,name:"安康市"},{id:26924,name:"汉中市"},{id:27125,name:"宝鸡市"},{id:27259,name:"铜川市"}]},32939:{id:32939,name:"新疆维吾尔自治区",cities:[{id:32940,name:"塔城地区"},{id:33052,name:"哈密地区"},{id:33108,name:"和田地区"},{id:33216,name:"阿勒泰地区"},{id:33284,name:"克孜勒苏柯尔克孜自治州"},{id:33328,name:"博尔塔拉蒙古自治州"},{id:33357,name:"克拉玛依市"},{id:33380,name:"乌鲁木齐市"},{id:33482,name:"石河子市"},{id:33492,name:"昌吉回族自治州"},{id:33580,name:"五家渠市"},{id:33588,name:"吐鲁番地区"},{id:33625,name:"巴音郭楞蒙古自治州"},{id:33726,name:"阿克苏地区"},{id:33843,name:"阿拉尔市"},{id:33861,name:"喀什地区"},{id:34045,name:"图木舒克市"},{id:34056,name:"伊犁哈萨克自治州"}]},5700:{id:5700,name:"黑龙江省",cities:[{id:5701,name:"哈尔滨市"},{id:6019,name:"齐齐哈尔市"},{id:6224,name:"牡丹江市"},{id:6325,name:"佳木斯市"},{id:6445,name:"绥化市"},{id:6659,name:"黑河市"},{id:6759,name:"大兴安岭地区"},{id:6811,name:"伊春市"},{id:7023,name:"大庆市"},{id:7124,name:"七台河市"},{id:7174,name:"鸡西市"},{id:7302,name:"鹤岗市"},{id:7368,name:"双鸭山市"}]}}},o={delivery:n("#J_delivery"),site:n("#site-selector")},r={props:{cities:s.provinceAndCities,provinceSet:null,countyAndTown:null,origin:{province:"广东",provinceId:18482,city:"广州市",cityId:19033},userSite:null,activeSite:{}},remoteUrl:{getSiteByIp:"//int.dpool.sina.com.cn/iplookup/iplookup.php?format=js",getDefaultSite:"//me.meizu.com/vip/address/default_new_address",queryChildren:"//area.meizu.com/area/child/batch_query",fastArrival:"//detail.meizu.com/api/sku/check_fast_arrival"},buildBaseHTML:function(){var e='<div data-widget="tabs"class="m JD-stock"id="JD-stock"><div class="mt"><ul class="tab"><li data-index="0"data-widget="tab-item"class="curr"><a href="#none"><em></em><i></i></a></li><li data-index="1"data-widget="tab-item"style="display:none;"><a href="#none"><em></em><i></i></a></li><li data-index="2"data-widget="tab-item"style="display:none;"><a href="#none"><em></em><i></i></a></li><li data-index="3"data-widget="tab-item"style="display:none;"><a href="#none"><em></em><i></i></a></li></ul><div class="stock-line"></div></div><div class="mc"data-area="0"data-widget="tab-content"id="site-province-item"></div><div class="mc"data-area="1"data-widget="tab-content"id="site-city-item"></div><div class="mc"data-area="2"data-widget="tab-content"id="site-area-item"></div><div class="mc"data-area="3"data-widget="tab-content"id="site-town-item"></div></div>',t='<div class="JD-stock-con">'+e+'</div><span class="vm-close"></span>';o.content=o.site.find(".content"),o.content.html(t),o.show=o.site.find(".text"),o.tabs=o.site.find(".tab li"),o.panels=o.site.find(".mc")},provinceShort:function(e){var t;switch(e.id){case 32939:t="新疆";break;case 25024:t="宁夏";break;case 10088:t="内蒙古";break;case 20238:t="广西";break;case 32166:t="西藏";break;default:t=e.name.replace("省","")}return{id:e.id,name:t}},init:function(){var e,t=this,i=t.props.cities,r=[];n.each(s.sort,function(n,a){e=t.provinceShort(i[a]),r.push({id:e.id,name:e.name})}),t.props.provinceSet=r,t.buildBaseHTML(),t.getDefaultSite().done(function(e){t.render(e),t.renderShowSite()}),t.bindEvent(),o.delivery.show(),window.livePropertyView.listenTo(window.livePropertyView.model,"change:skuId",t.queryFastArrival.bind(t,"skuId")),a.isEmpty(window.MZ.modelData.packageMap)||window.livePropertyView.listenTo(window.livePropertyView.model,"change:packageSkuIds",t.queryFastArrival.bind(t,"packageSkuIds"))},render:function(e){var t=this,i=e.provinceId,n=e.cityId,a=e.areaId,s=e.townId,r=[];if(o.panels.hide(),t.getAreaList(t.props.provinceSet,t.getIdNameByLevel(0)),t.props.cities[i]&&e.provinceId!==e.cityId&&t.getAreaList(t.props.cities[i].cities,t.getIdNameByLevel(1)),a&&s)o.panels.eq(3).show(),o.tabs.show().eq(3).addClass("curr").siblings().removeClass("curr"),r.push(n,a),t.queryFastArrival();else{if("origin"===e.type)return o.panels.eq(0).show(),void o.tabs.hide().first().show();o.panels.eq(2).show(),o.tabs.hide().filter(":lt(3)").show().last().addClass("curr").siblings().removeClass("curr"),r.push(n)}t.ajax(t.remoteUrl.queryChildren,{parentIds:r.join(",")},"get","jsonp").done(function(e){e[n]&&t.getAreaList(e[n],t.getIdNameByLevel(2)),e[a]&&t.getAreaList(e[a],t.getIdNameByLevel(3))})},renderShowSite:function(){var e=this,t=[],i=(e.props.activeSite,e.props.userSite,e.props.activeSite[0]&&e.props.activeSite[0].name||e.props.userSite.province),n=e.props.activeSite[1]&&e.props.activeSite[1].name||e.props.userSite.city,a=e.props.activeSite[2]&&e.props.activeSite[2].name||e.props.userSite.area,s=e.props.activeSite[3]&&e.props.activeSite[3].name||e.props.userSite.town;n&&t.push(n),a?t.push(a):t.unshift(i),s?t.push(s):t.push("【请选择】"),o.show.text(t.join(" "))},getIdNameByLevel:function(e){var t="";switch(e){case 0:t="site-province-item";break;case 1:t="site-city-item";break;case 2:t="site-area-item";break;case 3:t="site-town-item"}return t},improveIpInfo:function(e){var t,i,n=this;return t=n.matchSiteByUnicode(n.props.provinceSet,e.province),i=n.matchSiteByUnicode(n.props.cities[t].cities,e.city),t&&i?(e.provinceId=t,e.cityId=i,e):n.props.origin},matchSiteByUnicode:function(e,t){var t=t.toString(),i=!1;return n.each(e,function(e,n){if(t===n.name.toString()||t.match(n.name.toString())||n.name.toString().match(t))return i=n.id,!1}),i},getDefaultSite:function(){var e=this,t=n.Deferred();return e.ajax(e.remoteUrl.getDefaultSite,null,"get","jsonp").done(function(i){e.props.userSite=i,t.resolve(i)}).fail(function(i){e.props.userSite=e.props.origin,t.resolve(e.props.userSite)}),t.promise()},bindEvent:function(){var e,t=this;o.show.mouseover(function(){e=setTimeout(function(){o.site.addClass("hover")},200)}),o.site.mouseleave(function(){var t=n(this);t.hasClass("clicked")||t.removeClass("hover"),clearTimeout(e)}),o.site.on("click",".tab li",function(e){var t=n(this),i=t.index();t.addClass("curr").siblings().removeClass("curr"),o.panels.hide().eq(i).show(),e.preventDefault()}).on("click",".area-list a",function(e){var i=n(this),a=i.attr("data-value"),s=i.text(),r=i.parents(".mc").attr("data-area");o.tabs.eq(r).find("a").attr("title",s).find("em").html(s.length>6?s.substring(0,6)+"...":s),t.activeChildSite(r,a,s),e.preventDefault()}).on("click",".vm-close",function(){o.site.removeClass("hover clicked")})},activeChildSite:function(e,t,i){var n=this;n.props.activeSite[e]={id:t,name:i},e<3?(++e,n.ajax(n.remoteUrl.queryChildren,{parentIds:t},"get","jsonp").done(function(i){n.getAreaList(i[t],n.getIdNameByLevel(e),!0),o.panels.hide().eq(e).show()}),o.site.addClass("clicked"),o.tabs.eq(e).show().addClass("curr").find("em").text("请选择"),o.tabs.eq(e).nextAll().hide().end().siblings().removeClass("curr")):(o.site.removeClass("hover clicked"),n.renderShowSite(),n.queryFastArrival())},getAreaList:function(e,t,i){var a=this,s=['<ul class="area-list">'],o=[],r=[],c=n("#"+t),d=c.data("area"),l="";if(e&&e.length){c.empty();for(var u=0,h=e.length;u<h;u++)e[u].name=e[u].name.replace(" ",""),e[u].name.length>12?r.push("<li class='longer-area'><a href='#none' data-value='"+e[u].id+"'>"+e[u].name+"</a></li>"):e[u].name.length>5?o.push("<li class='long-area'><a href='#none' data-value='"+e[u].id+"'>"+e[u].name+"</a></li>"):0===e[u].id?l="<li><a href='#none' data-value='"+e[u].id+"'>"+e[u].name+"</a></li>":s.push("<li><a href='#none' data-value='"+e[u].id+"'>"+e[u].name+"</a></li>");s.push(o.join("")),s.push(r.join("")),s.push(l),s.push("</ul>"),c.html(s.join("")),i||a.renderShowTab(d)}},renderShowTab:function(e){var t=this.props.userSite,i=["province","city","area","town"],n=t[i[e]]||"请选择";o.tabs.eq(e).find("a").attr("title",n).find("em").html(n.length>6?n.substring(0,6)+"...":n)},queryFastArrival:function(e,t,i){var a=this,s=a.props.activeSite[0]&&a.props.activeSite[0].id||a.props.userSite.provinceId,o=a.props.activeSite[1]&&a.props.activeSite[1].id||a.props.userSite.cityId,r=a.props.activeSite[2]&&a.props.activeSite[2].id||a.props.userSite.areaId,c=a.props.activeSite[3]&&a.props.activeSite[3].id||a.props.userSite.townId,d=livePropertyView.model.get("quantity"),l=livePropertyView.model.get("skuId"),u=livePropertyView.model.get("packageSkuIds"),h=[];"skuId"===e&&"package"===t.get("skuIdChangeTarget")||"packageSkuIds"===e&&!u||c&&l&&(h.push({id:livePropertyView.model.get("skuId"),num:d}),u&&n.each(u,function(e,t){h.push({id:t,num:d})}),n.ajax({url:a.remoteUrl.fastArrival,type:"post",data:JSON.stringify({provinceId:s,cityId:o,areaId:r,townId:c,skus:h}),contentType:"application/json",dataType:"json"}).done(function(e){var t,i=e.data,a="",s="";e.success&&(1===i.fastArrivalStatus?(s="今天",a+='<a class="vm-today" href="//store.meizu.com/marrive/summary.html" target="_blank"><i class="icon icon-shandian"></i>当日达</a>'):2===i.fastArrivalStatus&&(t=new Date(i.arrivalDate),s="明天（"+(t.getMonth()+1)+"月"+t.getDate()+"日）",a+='<a class="vm-today" href="//store.meizu.com/marrive/summary.html" target="_blank"><i class="icon icon-shandian"></i>次日达</a>'),n("#J_siteStatus").html(a),i.payTime&&i.arrivalDate&&n("#J_siteStatus").append(i.payTime+" 前下单并支付，预计"+s+"送达"))}).fail(function(){alert("系统繁忙，请稍后再试！")}))},getUserId:function(){var e,t=n.cookie("MEIZUSTORESESSIONVAL");return t&&(e=JSON.parse(decodeURIComponent(t)).uid),e},ajax:function(e,t,i,a){var s=n.Deferred();return n.ajax({url:e,type:i?i:"get",data:t?t:null,dataType:a?a:"json",timeout:4e3,cache:!1}).done(function(e){e.success||200===e.code&&e.data?s.resolve(e.data):s.reject(e.message)}).fail(function(){s.reject("请求失败")}),s.promise()}};e.exports=r},function(e,t,i){var n,a,s;!function(o){a=[i(7)],n=o,s="function"==typeof n?n.apply(t,a):n,!(void 0!==s&&(e.exports=s))}(function(e){function t(e){return r.raw?e:encodeURIComponent(e)}function i(e){return r.raw?e:decodeURIComponent(e)}function n(e){return t(r.json?JSON.stringify(e):String(e))}function a(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(o," ")),r.json?JSON.parse(e):e}catch(t){}}function s(t,i){var n=r.raw?t:a(t);return e.isFunction(i)?i(n):n}var o=/\+/g,r=e.cookie=function(a,o,c){if(void 0!==o&&!e.isFunction(o)){if(c=e.extend({},r.defaults,c),"number"==typeof c.expires){var d=c.expires,l=c.expires=new Date;l.setTime(+l+864e5*d)}return document.cookie=[t(a),"=",n(o),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}for(var u=a?void 0:{},h=document.cookie?document.cookie.split("; "):[],m=0,p=h.length;m<p;m++){var f=h[m].split("="),g=i(f.shift()),v=f.join("=");if(a&&a===g){u=s(v,o);break}a||void 0===(v=s(v))||(u[g]=v)}return u};r.defaults={},e.removeCookie=function(t,i){return void 0!==e.cookie(t)&&(e.cookie(t,"",e.extend({},i,{expires:-1})),!e.cookie(t))}})},function(e,t,i){function n(){c.init()}var a=i(7),s=i(22);i(21);var o=window.MZ,r=window.dialog,c={remoteURL:{addFavorite:"//me.meizu.com/vip/favorite"},init:function(){var e=this;e.showTips(),e.bindEvent()},showTips:function(){localStorage&&"false"!==localStorage.getItem("global_favorite")&&a("#J_favoriteTips").show()},bindEvent:function(){var e=this;a("#J_favorite").on("click",function(t){var i=o.modelData.itemId;s.ajax(e.remoteURL.addFavorite,{itemId:i}).done(function(t){1===t?e.artAlert("收藏成功",!0):e.artAlert("您已收藏过该商品")}).fail(function(t){401===t.code?e.artAlert("请先登录"):e.artAlert(t.message)}),t.preventDefault(),t.stopPropagation()}),a("#J_favoriteTipsClose").on("click",function(e){var t=a(e.currentTarget);t.parent().fadeOut(100),localStorage&&localStorage.setItem("global_favorite","false")})},artAlert:function(e,t){var i=t?'<i class="icon icon-success"></i>':'<i class="icon icon-warning"></i>',n='<div class="bi-dialog" id="artAlert"><div class="bi-alert-bd tcenter"><div class="alert-message">'+i+'<p class="alert-message-bd"><span>'+e+'</span><a target="_blank" href="//me.meizu.com/member/favorite/index">查看我的收藏</a></p></div></div><a class="bi-close" id="J_DialogClose" href="javascript:;">╳</a></div>';r({width:360,height:180,content:n,onshow:function(){var e=this;a(e.node).on("click",".bi-close",function(){e.close().remove()})},backdropOpacity:.4}).showModal()}};window._Favorite=c,e.exports=n},function(e,t){e.exports='<%for(var i=0, length=packages.length; i<length; i++){%>\n    <a data-value="<%= packages[i].id %>" <%if(!packages[i].available){%>class="disabled"<%}%> href="#" title="<%= packages[i].name %>">\n        <p class="vm-text <% if (length === 1 && packages[i].id === 0) { %>vm-standard<% } %>">\n            <%=packages[i].name%>\n            <%if(packages[i].items && packages[i].items.length){%>\n                <%if(packages[i].available){%>\n                    <span class="vm-text-price">\n                        <%=packages[i].price%>元\n                    </span>\n                    <%if(packages[i].profits>0){%>\n                        <span class="vm-text-profits">省<em><%=packages[i].profits%></em>元</span>\n                    <%}%>\n                <% }else{ %>\n                    已售罄\n                <% } %>\n            <%}else if(length!==1){%>\n                <span class="vm-text-standard">无优惠</span>\n            <%}%>\n        </p>\n    </a>\n<%}%>'},function(e,t){e.exports='<ul class="clearfix">\n    <% for(var i = 0, length = items.length; i < length; i++) { %>\n    <li>\n        <p class="vm-pic">\n            <img src="<%= items[i].cells[items[i].recommend].images + \'@80x80.jpg\' %>" width="80" height="80" alt="<%= items[i].cells[items[i].recommend].names %>">\n        </p>\n        <p class="vm-tit">\n            <%= items[i].name %>\n        </p>\n        <p class="vm-price">\n            ¥ <%= items[i].cells[items[i].recommend].price.toFixed(2) %>\n        </p>\n        <div class="vm-prop">\n            <% for (var p in items[i].saleAttrs) { %>\n                <p>\n                <% for (var jj = 0, length2 = items[i].saleAttrs[p].length; jj < length2; jj++) { %>\n                    <% if (!items[i].saleAttrs[p][jj].imageColor || length2 === 1) { %>\n                        <a class="vm-prop-text <% if (items[i].recommend === p + \':\' + items[i].saleAttrs[p][jj].id) { %>selected<% } %>" href="javascript:;" data-sku="<%= items[i].cells[p + \':\' + items[i].saleAttrs[p][jj].id].skuId %>" data-sid="<%= items[i].id %>" data-key="<%= p + \':\' + items[i].saleAttrs[p][jj].id %>" title="<%= items[i].saleAttrs[p][jj].name %>">\n                            <span><%= items[i].saleAttrs[p][jj].name %></span>\n                        </a>\n                    <% } else { %>\n                        <a class="vm-prop-img <% if (items[i].recommend === p + \':\' + items[i].saleAttrs[p][jj].id) { %>selected<% } %>" href="javascript:;" data-sku="<%= items[i].cells[p + \':\' + items[i].saleAttrs[p][jj].id].skuId %>" data-sid="<%= items[i].id %>" data-key="<%= p + \':\' + items[i].saleAttrs[p][jj].id %>" title="<%= items[i].saleAttrs[p][jj].name %>">\n                            <img class="vm-prop-sale" src="<%= items[i].saleAttrs[p][jj].imageColor %>" width="20" height="20" >\n                       </a>\n                    <% } %>\n                <% } %>\n                </p>\n            <% } %>\n        </div>\n    </li>\n    <% } %>\n</ul>'},function(e,t){e.exports='<div class="bi-dialog" id="J_dialogOrder">\n    <div class="bi-dialog-inner">\n        <div class="bi-dialog-hd"></div>\n        <div class="bi-dialog-bd tcenter">\n            <img class="dialog-cont-pic" src="//store.res.meizu.com/resources/php/store/static/detail/assets/img/lineup.gif">\n        </div>\n        <p class="dialog-cont-text">\n            参加活动的人数较多，正在为您排队，请稍候！<br/>\n            无需刷新页面，排队自动进行中……\n        </p>\n        <div class="bi-dialog-ft"></div>\n    </div>\n    <a class="bi-close" id="J_DialogClose" href="javascript:;">╳</a>\n</div>\n'},function(e,t,i){var n,a,s;!function(o){a=[i(7)],n=o,s="function"==typeof n?n.apply(t,a):n,!(void 0!==s&&(e.exports=s))}(function(e){function t(t,n){this.$con=e(t),this.opts=e.extend({},i,n),this.init()}var i={eventype:"click",effect:"none",active:null,afterActive:e.noop,navSelector:".ui-tab-nav",contSelector:".ui-tab-content",delay:0};t.prototype={init:function(){var e=this,t=e.opts;e.setup(),e.bindEvent(),null!==t.active&&e.activate(t.active)},setup:function(){var e=this,t=e.$con;e.$tabs=t.find(e.opts.navSelector).children(),e.$panels=t.find(e.opts.contSelector).children()},bindEvent:function(){var t,i=this;i.$tabs.on(i.opts.eventype,function(n,a){var s=e(this),o=s.index();s.hasClass("current")||(t&&clearTimeout(t),t=setTimeout(function(){i.activate(o,a)},i.opts.delay),n.preventDefault())}),i.opts.delay&&i.$tabs.on("mouseleave",function(){clearTimeout(t)})},activate:function(e,t){var i=this,n=i.opts,a={none:function(){i.$panels.hide().eq(e).show()},fade:function(){i.$panels.hide().eq(e).fadeIn()}};a[i.opts.effect](),i.$tabs.eq(e).addClass("current").siblings().removeClass("current"),i.$panels.eq(e).addClass("current").siblings().removeClass("current"),n.afterActive(i.$tabs.eq(e),e,t)}},e.fn.vtab=function(i){return this.each(function(){var n=e(this),a=n.data("vtab");a||n.data("vtab",a=new t(this,i)),"string"==typeof i&&a[i]()})}})},function(e,t,i){var n=i(7);!function(e,t,i,n){var a=e(t);e.fn.lazyload=function(s){function o(){var t=0;c.each(function(){var i=e(this);if(!d.skip_invisible||i.is(":visible"))if(e.abovethetop(this,d)||e.leftofbegin(this,d));else if(e.belowthefold(this,d)||e.rightoffold(this,d)){if(++t>d.failure_limit)return!1}else i.trigger("appear"),t=0})}var r,c=this,d={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return s&&(n!==s.failurelimit&&(s.failure_limit=s.failurelimit,delete s.failurelimit),n!==s.effectspeed&&(s.effect_speed=s.effectspeed,delete s.effectspeed),e.extend(d,s)),r=d.container===n||d.container===t?a:e(d.container),0===d.event.indexOf("scroll")&&r.bind(d.event,function(){return o()}),this.each(function(){var t=this,i=e(t);t.loaded=!1,i.attr("src")!==n&&i.attr("src")!==!1||i.is("img")&&i.attr("src",d.placeholder),i.one("appear",function(){if(!this.loaded){if(d.appear){var n=c.length;d.appear.call(t,n,d)}e("<img />").bind("load",function(){var n=i.attr("data-"+d.data_attribute);i.hide(),i.is("img")?i.attr("src",n):i.css("background-image","url('"+n+"')"),i[d.effect](d.effect_speed),t.loaded=!0;var a=e.grep(c,function(e){return!e.loaded});if(c=e(a),d.load){var s=c.length;d.load.call(t,s,d)}}).attr("src",i.attr("data-"+d.data_attribute))}}),0!==d.event.indexOf("scroll")&&i.bind(d.event,function(){t.loaded||i.trigger("appear")})}),a.bind("resize",function(){o()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&a.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&c.each(function(){e(this).trigger("appear")})}),e(i).ready(function(){o()}),this},e.belowthefold=function(i,s){var o;return o=s.container===n||s.container===t?(t.innerHeight?t.innerHeight:a.height())+a.scrollTop():e(s.container).offset().top+e(s.container).height(),o<=e(i).offset().top-s.threshold},e.rightoffold=function(i,s){var o;return o=s.container===n||s.container===t?a.width()+a.scrollLeft():e(s.container).offset().left+e(s.container).width(),o<=e(i).offset().left-s.threshold},e.abovethetop=function(i,s){var o;return o=s.container===n||s.container===t?a.scrollTop():e(s.container).offset().top,o>=e(i).offset().top+s.threshold+e(i).height()},e.leftofbegin=function(i,s){var o;return o=s.container===n||s.container===t?a.scrollLeft():e(s.container).offset().left,o>=e(i).offset().left+s.threshold+e(i).width()},e.inviewport=function(t,i){return!(e.rightoffold(t,i)||e.leftofbegin(t,i)||e.belowthefold(t,i)||e.abovethetop(t,i))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(n,window,document)},function(e,t,i){var n,a,s;!function(o){a=[i(7)],n=o,s="function"==typeof n?n.apply(t,a):n,!(void 0!==s&&(e.exports=s))}(function(e){var t={min:0,max:0,buffer:0,container:window,fixClass:"fixed",onEnter:null,onLeave:null};return ScrollFix=function(i,n){this.$elem=e(i),this.opts=e.extend({},t,n),this.init()},ScrollFix.prototype={constructor:ScrollFix,init:function(){var t=this,i=t.opts;"string"==typeof i.max&&(i.max=e(i.max)),"string"==typeof i.min&&(i.min=e(i.min)),t.bindEvent()},bindEvent:function(){var t,i=this,n=i.opts,a=i.$elem,s=e(n.container),o=n.max,r=n.min,c=!1,d=0,l=0;s.on("scroll.scrollfix",function(){t=s.scrollTop()+n.buffer,o.length&&(d=o.offset().top),r.length&&(l=r.offset().top),0===l&&(l=a.offset().top),0===d&&(d=e(document).height()),t>=l&&t<=d?c||(c=!0,a.addClass(n.fixClass),e.isFunction(n.onEnter)&&n.onEnter(a[0],t)):c&&(c=!1,a.removeClass(n.fixClass),e.isFunction(n.onLeave)&&n.onLeave(a[0],t))})},destroy:function(){this.$elem.removeData("scrollfix"),this.opts.container.off("scroll.scrollfix")}},e.fn.scrollfix=function(t){return this.each(function(){var i=e(this),n=(i.data("scrollfix"),"object"==typeof t&&t);new ScrollFix(this,n)})},ScrollFix})},function(e,t,i){var n,a,s;!function(o){a=[i(7)],n=o,s="function"==typeof n?n.apply(t,a):n,!(void 0!==s&&(e.exports=s))}(function(e){e.extend(e.easing,{easeOutCubic:function(e,t,i,n,a){return n*((t=t/a-1)*t*t+1)+i}});var t={speed:0,smartShow:!0,smartHeight:200,scrollTo:0,container:null},i=function(i){this.opts=e.extend({},t,i),this.init()};return i.prototype={init:function(){var t=this,i=t.opts;t.$container=e(i.container?container:document),t.$conBody=t.render(),t.opts.smartShow&&t.autoShow(),t.bindEvent()},bindEvent:function(){var e=this;e.$conBody.on("click",".gotop-arrow",function(){e.goTop()})},goTop:function(){var t=this,i=t.opts,n=i.speed,a=i.scrollTo;e.isNumeric(n)?e("html,body").animate({scrollTop:a},n,"easeOutCubic"):"string"==typeof a&&t.$container.scrollTop(e(i.scrollTo).offset().top)},autoShow:function(){var t,i=this,n=i.$container,a=i.$conBody,s=n.width(),o=this.opts.smartHeight;s<1240&&e("siteGotop").css({left:"initial",right:10,marginLeft:0}),n.scrollTop()>o&&a.fadeIn(300),n.on("scroll",function(){i.timer&&(clearTimeout(i.timer),t=null),i.timer=setTimeout(function(){n.scrollTop()>o?a.fadeIn():a.fadeOut("fast")},100)})},render:function(){var t=this,i='<div class="site-gotop" id="siteGotop"><a class="gotop-suggest" title="建议反馈" href="//me.meizu.com/member/advice/index" target="_blank"></a><div class="gotop-arrow" title="回到顶部"></div></div>',n=".site-gotop{position:fixed;width:44px;bottom:50px;left:50%;margin-left:640px;display:none}.gotop-suggest,.gotop-arrow{display:inline-block;width:44px;height:44px;background:#b4b4b4 no-repeat 50%50%;cursor:pointer}.gotop-suggest{background-image:url(//store.res.meizu.com/resources/php/store/static/detail/assets/img/suggest.png)}.gotop-arrow{background-image:url(//store.res.meizu.com/resources/php/store/static/detail/assets/img/gotop-arrow.png);margin-top:5px}";return t.createStyle(n),e(i).appendTo("body")},createStyle:function(e){var t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)},destroy:function(){this.$container.off("scroll.scrollfix")}},i})}]));